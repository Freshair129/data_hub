generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model Customer {
  id             String          @id @default(cuid())
  customerId     String          @unique @map("customer_id")
  memberId       String?         @map("member_id")
  status         String          @default("Active")
  firstName      String?         @map("first_name")
  lastName       String?         @map("last_name")
  nickName       String?         @map("nick_name")
  jobTitle       String?         @map("job_title")
  company        String?
  membershipTier String          @default("MEMBER") @map("membership_tier")
  lifecycleStage String          @default("Lead") @map("lifecycle_stage")
  joinDate       DateTime?       @map("join_date")
  profilePicture String?         @map("profile_picture")
  email          String?
  phonePrimary   String?         @map("phone_primary")
  lineId         String?         @map("line_id")
  facebookId     String?         @unique @map("facebook_id")
  facebookName   String?         @map("facebook_name")
  walletBalance  Float           @default(0) @map("wallet_balance")
  walletPoints   Int             @default(0) @map("wallet_points")
  walletCurrency String          @default("THB") @map("wallet_currency")
  intelligence   Json?           @default("{}")
  conversationId String?         @map("conversation_id")
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")
  cart           CartItem[]
  conversations  Conversation[]
  inventory      InventoryItem[]
  orders         Order[]
  tasks          Task[]
  timeline       TimelineEvent[]

  @@map("customers")
}

model Order {
  id           String        @id @default(cuid())
  orderId      String        @unique @map("order_id")
  customerId   String        @map("customer_id")
  date         DateTime
  status       String        @default("PENDING")
  totalAmount  Float         @map("total_amount")
  paidAmount   Float         @default(0) @map("paid_amount")
  items        Json          @default("[]")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  customer     Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@map("orders")
}

model Transaction {
  id            String   @id @default(cuid())
  transactionId String   @unique @map("transaction_id")
  orderId       String   @map("order_id")
  date          DateTime
  amount        Float
  type          String
  method        String   @default("Transfer")
  chatMessageId String?  @map("chat_message_id")
  note          String?
  slipImageUrl  String?  @map("slip_image_url")
  slipStatus    String?  @map("slip_status")
  slipData      Json?    @map("slip_data")
  createdAt     DateTime @default(now()) @map("created_at")
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model InventoryItem {
  id         String    @id @default(cuid())
  customerId String    @map("customer_id")
  type       String
  itemId     String    @map("item_id")
  name       String
  enrollDate DateTime? @map("enroll_date")
  expiryDate DateTime? @map("expiry_date")
  status     String    @default("ACTIVE")
  metadata   Json?     @default("{}")
  createdAt  DateTime  @default(now()) @map("created_at")
  customer   Customer  @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@map("inventory_items")
}

model TimelineEvent {
  id         String   @id @default(cuid())
  eventId    String   @map("event_id")
  customerId String   @map("customer_id")
  date       DateTime
  type       String
  summary    String
  details    Json?    @default("{}")
  createdAt  DateTime @default(now()) @map("created_at")
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@map("timeline_events")
}

model Conversation {
  id              String    @id @default(cuid())
  conversationId  String    @unique @map("conversation_id")
  customerId      String?   @map("customer_id")
  channel         String    @default("facebook")
  participantName String?   @map("participant_name")
  participantId   String?   @map("participant_id")
  assignedAgent   String?   @map("assigned_agent")
  lastMessageAt   DateTime? @map("last_message_at")
  unreadCount     Int       @default(0) @map("unread_count")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  customer        Customer? @relation(fields: [customerId], references: [id])
  messages        Message[]
  episodes        ChatEpisode[]

  @@map("conversations")
}

model Message {
  id             String       @id @default(cuid())
  messageId      String       @unique @map("message_id")
  conversationId String       @map("conversation_id")
  attachmentId   String?      @map("attachment_id")
  sessionId      String?      @map("session_id")
  episodeId      String?      @map("episode_id")
  metadata       Json?        @default("{}")
  fromName       String?      @map("from_name")
  fromId         String?      @map("from_id")
  content        String?
  hasAttachment  Boolean      @default(false) @map("has_attachment")
  attachmentType String?      @map("attachment_type")
  attachmentUrl  String?      @map("attachment_url")
  createdAt      DateTime     @default(now()) @map("created_at")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model ChatEpisode {
  id             String       @id @default(cuid())
  episodicId     String       @unique @map("episodic_id")
  episodicName   String       @map("episodic_name")
  msgRef         String?      @map("msg_ref")
  summary        String?
  salineAnchor   String?      @map("saline_anchor")
  state          String?
  note           String?
  cta            String?
  tags           Json?        @default("[]")
  sessionId      String       @map("session_id")
  conversationId String       @map("conversation_id")
  createdAt      DateTime     @default(now()) @map("created_at")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@map("chat_episodes")
}

model Employee {
  id             String    @id @default(cuid())
  employeeId     String    @unique @map("employee_id")
  agentId        String?   @unique @map("agent_id")
  firstName      String    @map("first_name")
  lastName       String    @map("last_name")
  nickName       String?   @map("nick_name")
  role           String    @default("sales")
  department     String?
  profilePicture String?   @map("profile_picture")
  status         String    @default("Active")
  joinDate       DateTime? @map("join_date")
  email          String    @unique
  phonePrimary   String?   @map("phone_primary")
  lineId         String?   @map("line_id")
  passwordHash   String    @map("password_hash")
  permissions    Json      @default("{}")
  performance    Json?     @default("{}")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  tasks          Task[]

  @@map("employees")
}

model Product {
  id           String     @id @default(cuid())
  productId    String     @unique @map("product_id")
  name         String
  description  String?
  price        Float
  basePrice    Float?     @map("base_price")
  image        String?
  category     String     @default("course")
  duration     Int?
  durationUnit String?    @map("duration_unit")
  metadata     Json?      @default("{}")
  isActive     Boolean    @default(true) @map("is_active")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  cartItems    CartItem[]

  @@map("products")
}

model Campaign {
  id              String     @id @default(cuid())
  campaignId      String     @unique @map("campaign_id")
  name            String
  objective       String?
  status          String     @default("ACTIVE")
  spend           Float      @default(0)
  impressions     Int        @default(0)
  clicks          Int        @default(0)
  leads           Int        @default(0)
  purchases       Int        @default(0)
  mappedProductId String?    @map("mapped_product_id")
  rawData         Json?      @map("raw_data")
  startDate       DateTime?  @map("start_date")
  endDate         DateTime?  @map("end_date")
  adAccountId     String?    @map("ad_account_id")
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")
  revenue         Float      @default(0)
  roas            Float      @default(0)
  adSets          AdSet[]
  adAccount       AdAccount? @relation(fields: [adAccountId], references: [id])

  @@map("campaigns")
}

model AdAccount {
  id        String     @id @default(cuid())
  accountId String     @unique
  name      String
  currency  String     @default("THB")
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  campaigns Campaign[]

  @@map("ad_accounts")
}

model AdSet {
  id          String   @id @default(cuid())
  adSetId     String   @unique @map("ad_set_id")
  name        String
  status      String
  campaignId  String   @map("campaign_id")
  dailyBudget Float?   @map("daily_budget")
  targeting   Json?    @default("{}")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  campaign    Campaign @relation(fields: [campaignId], references: [id])
  ads         Ad[]

  @@map("ad_sets")
}

model Ad {
  id           String      @id @default(cuid())
  adId         String      @unique @map("ad_id")
  name         String
  status       String
  adSetId      String      @map("ad_set_id")
  creativeId   String?     @map("creative_id")
  experimentId String?     @map("experiment_id")
  variantName  String?     @map("variant_name")
  spend        Float       @default(0)
  impressions  Int         @default(0)
  clicks       Int         @default(0)
  cfr          Float       @default(0)
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")
  revenue      Float       @default(0)
  roas         Float       @default(0)
  adSet        AdSet       @relation(fields: [adSetId], references: [id])
  creative     AdCreative? @relation(fields: [creativeId], references: [id])
  experiment   Experiment? @relation(fields: [experimentId], references: [id])

  @@index([experimentId])
  @@map("ads")
}

model AdCreative {
  id           String   @id @default(cuid())
  name         String
  body         String?
  headline     String?
  imageUrl     String?  @map("image_url")
  videoUrl     String?  @map("video_url")
  callToAction String?  @map("call_to_action")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  ads          Ad[]

  @@map("ad_creatives")
}

model Experiment {
  id             String    @id @default(cuid())
  name           String
  description    String?
  status         String
  startDate      DateTime? @map("start_date")
  endDate        DateTime? @map("end_date")
  hypothesis     String?
  winningVariant String?   @map("winning_variant")
  conclusion     String?
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")
  ads            Ad[]

  @@map("experiments")
}

model AdDailyMetric {
  id          String   @id @default(cuid())
  adId        String   @map("ad_id")
  date        DateTime @db.Date
  spend       Float
  impressions Int
  clicks      Int
  leads       Int
  purchases   Int
  createdAt   DateTime @default(now()) @map("created_at")
  revenue     Float    @default(0)
  roas        Float    @default(0)

  @@unique([adId, date])
  @@map("ad_daily_metrics")
}

model Task {
  id          String    @id @default(cuid())
  taskId      String    @unique @map("task_id")
  customerId  String?   @map("customer_id")
  assigneeId  String?   @map("assignee_id")
  title       String
  description String?
  type        String    @default("FOLLOW_UP")
  priority    String    @default("MEDIUM")
  status      String    @default("PENDING")
  dueDate     DateTime? @map("due_date")
  completedAt DateTime? @map("completed_at")
  aiGenerated Boolean   @default(false) @map("ai_generated")
  aiContext   Json?     @map("ai_context")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  assignee    Employee? @relation(fields: [assigneeId], references: [id])
  customer    Customer? @relation(fields: [customerId], references: [id])

  @@map("tasks")
}

model CartItem {
  id         String   @id @default(cuid())
  customerId String   @map("customer_id")
  productId  String   @map("product_id")
  quantity   Int      @default(1)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([customerId, productId])
  @@map("cart_items")
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  actor     String
  target    String?
  status    String   @default("PENDING")
  traceId   String?  @map("trace_id")
  details   Json?    @default("{}")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([action, createdAt])
  @@index([target])
  @@map("audit_logs")
}
